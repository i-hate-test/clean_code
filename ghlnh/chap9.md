## 9장 단위 테스트

### TDD법칙 세 가지

- 첫째 법칙: 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
- 둘째 법칙 : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
- 셋째 법칙: 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

### 깨끗한 테스트 코드 유지하기

문제는 실제 코드가 진화하면 테스트 코드도 변해야 한다는 데 있다. 그런데 테스트 코드가 지저분할수록 변경하기 어려워진다. 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸리기 십상이다. 실제 코드를 변경해 기존 테스트 케이스가 실패하기 시작하면, 지저분한 코드로 인해, 실패하는 테스트 케이스를 점점 더 통과시키기 어려워진다. 그래서 테스트 코드는 계속해서 늘어나는 부담이 되버린다.

테스트 코드는 실제 코드 못지 않게 중요하다. 테스트 코드는 이류 시민이 아니다. 테스트 코드는 사고와 설계와 주의가 필요하다. 실제 코드 못지 않게 깨끗하게 짜야 한다.

*테스트는 유연성, 유지보수성, 재사용성을 제공한다.*

테스트 케이스가 없다면 모든 변경이 잠정적인 버그다. 아키텍처가 아무리 유연하더라도, 설계를 아무리 잘 나눴더라도, 테스트 케이스가 없으면 개발자는 변경을 주저한다. 버그가 숨어들까 두렵기 때문이다. 

### 깨끗한 테스트 코드

깨끗한 테스트 코드를 만들려면? 세 가지가 필요하다. 가독성, 가독성, 가독성.

어쩌면 가독성은 실제 코드보다 테스트 코드에 더더욱 중요하다. 테스트 코드에서 가독성 높이려면? 여느 코드와 마찬가지다. 명료성, 단순성, 풍부한 표현력이 필요하다. 테스트 코드는 최소한의 표현으로 많은 것을 나타내야 한다. 

- BUILD-OPERATE-CEHCK 패턴
    - BUILD: 테스트 자료를 만든다.
        
        이 단계에서 목업 데이터를 만들거나, 테스트용 데이터 베이스에 데이터를 넣는다
        
    - OPERATE: 테스트 자료를 조작한다.
        
        테스트 하고자하는 시스템의 함수를 호출
        
    - CHECK: 조작의 결과를 확인한다.
        
        여기서 assert 체크함
        

실제 환경에서는 절대로 안 되지만 테스트 환경에서는 전혀 문제없는 방식이 있다. 대개 메모리나 CPU 효율과 관련있는 경우다. 코드의 깨끗함과는 철저히 무관하다.

### 테스트당 assert하나

*테스트당 개념 하나*

한 테스트 함수에서 여러 개념을 테스트한다는 사실이 문제다. 그로므로 가장 좋은 규칙은 “개념 당 assert문 수를 최소로 줄여라”와, “테스트 함수 하나는 개념 하나만 테스트하라”라 하겠다.

### F.I.R.S.T

깨끗한 테스트는 다음 다섯가지 규칙을 따른다.

- **빠르게(Fast)**: 테스트는 빨라야한다. 테스트는 빨리 돌아야 한다는 말이다.
- **독립적으로(Indepenednt)**: 각 테스트는 서로 의존하면 안된다. 한 테스트가 다음 테스트가 실행될 환경을 준비해서는 안 된다. 각 테스트는 독립적으로 그리고 어떤 순서로 실행해도 괜찮아야 한다.
- **반복적으로(Repeatable)**: 테스트는 어떤 환경에서도 반복 가능해야한다. 실제 환경, QA 환경, 네트워크에 연결되지 않은 노트북 환경에서도 실행할 수 있어야 한다.
- **자가검증하는(Self-Validating)**: 테스트는 bool값으로 결과를 내야한다. 성공 아니면 실패다. 통과 여부를 알려고 로그 파일을 읽게 만들어서는 안 된다.
- **적시에(Timely)**: 테스트는 적시에 작성해야 한다. 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다. 실제 코드를 구현한 다음에 테스트 코드를 만들면 실제 코드가 테스트하기 어렵다는 사실을 발견할 지도 모른다.

### 결론

테스트 코드는 실제 코드만큼이나 프로젝트 건강에 중요하다. 어쩌면 실제 코드보다 더 중요할지도 모르겠다. 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문이다. 그러므로 테스트 코드는 지속적으로 깨끗하게 관리하자. 표현력을 높이고 간결하게 정리하자. 테스트 API를 구현해 도메인 특화언어를 만들자. 그러면 그만큼 테스트 코드를 짜기가 쉬워진다.